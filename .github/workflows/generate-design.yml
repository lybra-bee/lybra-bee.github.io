
name: Generate Design Assets

on:
  workflow_dispatch:  # Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº
  schedule:
    - cron: '0 0 * * 0'  # ĞšĞ°Ğ¶Ğ´Ğ¾Ğµ Ğ²Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ Ğ² 00:00

permissions:
  contents: write

jobs:
  generate-design:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests pillow
          echo "ğŸ“¦ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½Ğ°"

      - name: Generate design assets
        env:
          STABILITYAI_KEY: ${{ secrets.STABILITYAI_KEY }}
        run: |
          echo "=== Ğ“Ğ•ĞĞ•Ğ ĞĞ¦Ğ˜Ğ¯ Ğ”Ğ˜Ğ—ĞĞ™Ğ-Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢ĞĞ’ ==="
          echo "ğŸ¨ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ¿Ğ°Ğ¿Ğ¾Ğº..."
          echo "ğŸ–¼ï¸ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ„Ğ¾Ğ½Ğ¾Ğ² Ğ¸ Ñ‚ĞµĞºÑÑ‚ÑƒÑ€"
          echo "ğŸ”· Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸ĞºĞ¾Ğ½Ğ¾Ğº Ğ¸ UI ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²"
          
          # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¿Ğ°Ğ¿ĞºÑƒ Ğ´Ğ»Ñ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° ĞµÑĞ»Ğ¸ Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚
          mkdir -p .github/scripts
          
          # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ» ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ°
          cat > .github/scripts/generate_design.py << 'EOF'
#!/usr/bin/env python3
import os
import requests
import random
import base64
from datetime import datetime

def generate_design_assets():
    """Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ²ÑĞµÑ… Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½-ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ ÑĞ°Ğ¹Ñ‚Ğ°"""
    print("ğŸ¨ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½-ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²...")
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ¿Ğ°Ğ¿Ğ¾Ğº
    create_design_folders()
    
    # Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
    generate_backgrounds()
    generate_hero_elements()
    generate_icons()
    generate_patterns()
    generate_ui_elements()
    
    print("âœ… Ğ’ÑĞµ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½-ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹!")

def create_design_folders():
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ¿Ğ°Ğ¿Ğ¾Ğº Ğ´Ğ»Ñ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½Ğ°"""
    folders = [
        'static/images/design/hero',
        'static/images/design/patterns',
        'static/images/design/icons',
        'static/images/design/ui',
        'static/images/backgrounds'
    ]
    
    for folder in folders:
        os.makedirs(folder, exist_ok=True)
        print(f"ğŸ“ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ° Ğ¿Ğ°Ğ¿ĞºĞ°: {folder}")

def generate_backgrounds():
    """Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ„Ğ¾Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹"""
    print("\nğŸ¨ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ„Ğ¾Ğ½Ğ¾Ğ²...")
    
    backgrounds = {
        "bg-dark": "Dark cosmic background with stars and nebulae, deep blue and purple colors, 4K, high resolution, no text",
        "bg-gradient-blue": "Smooth blue gradient background from dark blue to electric blue, minimalist, abstract, 1920x1080",
        "bg-particles": "Floating digital particles with blue glow, dark background, abstract tech style, 1920x1080",
        "bg-neural": "Neural network background with interconnected nodes and pathways, blue glow, dark background, 1920x1080"
    }
    
    for name, prompt in backgrounds.items():
        generate_stability_image(
            prompt=prompt,
            output_path=f"static/images/backgrounds/{name}.jpg",
            width=1920,
            height=1080
        )

def generate_hero_elements():
    """Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ hero ÑĞµĞºÑ†Ğ¸Ğ¸"""
    print("\nğŸ¨ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ hero ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²...")
    
    hero_elements = {
        "hero-bg": "Futuristic AI brain with neural connections in digital space, blue and purple neon lights, cyberpunk style, epic composition, 1920x1080",
        "hero-particle": "Floating tech particle with energy glow, transparent background, PNG, blue neon, 512x512",
        "hero-gradient": "Blue to purple gradient overlay with light effects, transparent background, PNG, 1920x1080"
    }
    
    for name, prompt in hero_elements.items():
        generate_stability_image(
            prompt=prompt,
            output_path=f"static/images/design/hero/{name}.png",
            width=1920 if 'bg' in name else 512,
            height=1080 if 'bg' in name else 512
        )

def generate_icons():
    """Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸ĞºĞ¾Ğ½Ğ¾Ğº"""
    print("\nğŸ¨ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸ĞºĞ¾Ğ½Ğ¾Ğº...")
    
    icons = {
        "icon-ai": "AI brain icon, blue neon style, futuristic, glowing, simple design, transparent background, PNG, 256x256",
        "icon-network": "Neural network icon, connected nodes, blue glow, transparent background, vector style, 256x256",
        "icon-chip": "Computer chip icon, futuristic, circuit lines, blue glow, transparent PNG, 256x256",
        "icon-quantum": "Quantum computing icon, particles and waves, blue energy, transparent background, 256x256",
        "icon-robot": "Robot face icon, minimalist, blue neon outline, futuristic, transparent PNG, 256x256"
    }
    
    for name, prompt in icons.items():
        generate_stability_image(
            prompt=prompt,
            output_path=f"static/images/design/icons/{name}.png",
            width=256,
            height=256
        )

def generate_patterns():
    """Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚ÑƒÑ€ Ğ¸ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ²"""
    print("\nğŸ¨ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ²...")
    
    patterns = {
        "pattern-neural": "Neural network pattern, interconnected nodes and pathways, blue on dark background, seamless texture, 1000x1000",
        "pattern-circuit": "Circuit board texture, electronic lines and components, blue glow, dark background, seamless, 1000x1000",
        "pattern-hexagon": "Hexagon grid pattern, futuristic, blue glow, transparent background, PNG, 1000x1000",
        "pattern-dots": "Digital dots pattern, floating particles with blue glow, dark background, seamless, 1000x1000"
    }
    
    for name, prompt in patterns.items():
        generate_stability_image(
            prompt=prompt,
            output_path=f"static/images/design/patterns/{name}.png",
            width=1000,
            height=1000
        )

def generate_ui_elements():
    """Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ UI ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²"""
    print("\nğŸ¨ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ UI ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²...")
    
    ui_elements = {
        "button-bg": "Futuristic button background, blue glass morphism effect, glowing edges, transparent corners, PNG, 300x100",
        "card-bg": "Modern card background with subtle tech pattern, blue tint, glass effect, 400x300",
        "nav-bg": "Navigation bar background, dark with blue accents, minimalist tech style, 1920x80",
        "gradient-overlay": "Blue to transparent gradient overlay, smooth transition, PNG, 1920x500"
    }
    
    for name, prompt in ui_elements.items():
        sizes = {
            "button-bg": (300, 100),
            "card-bg": (400, 300),
            "nav-bg": (1920, 80),
            "gradient-overlay": (1920, 500)
        }
        
        width, height = sizes[name]
        generate_stability_image(
            prompt=prompt,
            output_path=f"static/images/design/ui/{name}.png",
            width=width,
            height=height
        )

def generate_stability_image(prompt, output_path, width, height):
    """Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· Stability AI"""
    stability_key = os.getenv('STABILITYAI_KEY')
    
    if not stability_key:
        print(f"âŒ STABILITYAI_KEY Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ´Ğ»Ñ {output_path}")
        return False
    
    try:
        # Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñ‹ Ğ´Ğ»Ñ SDXL
        allowed_dimensions = [
            (1024, 1024), (1152, 896), (1216, 832), 
            (1344, 768), (1536, 640), (640, 1536),
            (768, 1344), (832, 1216), (896, 1152)
        ]
        
        # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¸Ğ»Ğ¸ Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞ¸Ğ¹ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ½Ñ‹Ğ¹
        final_width, final_height = get_closest_dimension(width, height, allowed_dimensions)
        
        url = "https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/text-to-image"
        
        headers = {
            "Authorization": f"Bearer {stability_key}",
            "Content-Type": "application/json",
            "Accept": "application/json"
        }
        
        payload = {
            "text_prompts": [{"text": prompt, "weight": 1.0}],
            "cfg_scale": 7,
            "height": final_height,
            "width": final_width,
            "samples": 1,
            "steps": 30,
            "style_preset": "digital-art"
        }
        
        print(f"   Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ: {os.path.basename(output_path)} ({final_width}x{final_height})")
        
        response = requests.post(url, headers=headers, json=payload, timeout=120)
        
        if response.status_code == 200:
            data = response.json()
            if 'artifacts' in data and data['artifacts']:
                image_data = base64.b64decode(data['artifacts'][0]['base64'])
                
                with open(output_path, 'wb') as f:
                    f.write(image_data)
                
                print(f"   âœ… Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾: {output_path}")
                return True
        else:
            print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° {response.status_code}: {response.text[:100]}")
            
    except Exception as e:
        print(f"   âŒ Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ: {e}")
    
    return False

def get_closest_dimension(width, height, allowed_dimensions):
    """ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞ¸Ğ¹ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€"""
    closest = min(allowed_dimensions, key=lambda dim: abs(dim[0] - width) + abs(dim[1] - height))
    return closest

if __name__ == "__main__":
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ°
    if not os.getenv('STABILITYAI_KEY'):
        print("âŒ STABILITYAI_KEY Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ")
        print("ğŸ’¡ Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ² GitHub Secrets: STABILITYAI_KEY")
        exit(1)
    
    # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ
    generate_design_assets()
EOF

          # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ÑĞºÑ€Ğ¸Ğ¿Ñ‚
          python .github/scripts/generate_design.py
          echo "=== Ğ“Ğ•ĞĞ•Ğ ĞĞ¦Ğ˜Ğ¯ Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ ==="

      - name: Commit and push design assets
        run: |
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
          
          echo "ğŸ“Š Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:"
          find static/images/ -name "*.jpg" -o -name "*.png" | head -10
          echo "..."
          
          git add static/images/
          
          if git diff --staged --quiet; then
            echo "âŒ ĞĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ°"
            exit 0
          fi
          
          git commit -m "ğŸ¨ Auto-generated design assets: $(date +"%d.%m.%Y")"
          git pull --rebase
          git push
          echo "âœ… Ğ”Ğ¸Ğ·Ğ°Ğ¹Ğ½-ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ·Ğ°Ğ¿ÑƒÑˆĞµĞ½Ñ‹!"

      - name: Final report
        run: |
          echo "=== ĞĞ¢Ğ§Ğ•Ğ¢ ĞŸĞ Ğ”Ğ˜Ğ—ĞĞ™ĞĞ£ ==="
          echo "ğŸ“ Ğ¤Ğ¾Ğ½Ğ¾Ğ²: $(find static/images/backgrounds -name "*.jpg" | wc -l)"
          echo "ğŸ¨ Hero ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²: $(find static/images/design/hero -name "*.png" | wc -l)"
          echo "ğŸ”· Ğ˜ĞºĞ¾Ğ½Ğ¾Ğº: $(find static/images/design/icons -name "*.png" | wc -l)"
          echo "ğŸ”² ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ²: $(find static/images/design/patterns -name "*.png" | wc -l)"
          echo "ğŸ–¥ï¸ UI ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²: $(find static/images/design/ui -name "*.png" | wc -l)"
          echo "âœ… Ğ’ÑĞµĞ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: $(find static/images/ -name "*.jpg" -o -name "*.png" | wc -l)"
