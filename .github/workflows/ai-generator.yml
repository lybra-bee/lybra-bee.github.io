name: AI Content Generator

on:
  workflow_dispatch:
  schedule:
    - cron: '0 9 * * *'  # ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð² 09:00 UTC

permissions:
  contents: write

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          pip install requests pillow numpy huggingface-hub
          echo "ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð° Ð¸ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹"

      - name: Run daily content generator
        env:
          # GigaChat API (Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾)
          GIGACHAT_CLIENT_ID: ${{ secrets.GIGACHAT_CLIENT_ID }}
          GIGACHAT_CLIENT_SECRET: ${{ secrets.GIGACHAT_CLIENT_SECRET }}
          
          # Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ API (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          HUGGINGFACE_TOKEN: ${{ secrets.HUGGINGFACE_TOKEN }}
          STABILITYAI_KEY: ${{ secrets.STABILITYAI_KEY }}
        run: |
          echo "=== Ð•Ð–Ð•Ð”ÐÐ•Ð’ÐÐÐ¯ Ð“Ð•ÐÐ•Ð ÐÐ¦Ð˜Ð¯ ÐšÐžÐÐ¢Ð•ÐÐ¢Ð ==="
          echo "ðŸ§¹ Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ 3 Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ ÑÑ‚Ð°Ñ‚ÑŒÐ¸"
          echo "ðŸ¤– Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ñ‚ÐµÐ¼ AI/Ñ‚ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¸"
          echo "ðŸŽ¨ Ð ÐµÐ°Ð»ÑŒÐ½Ð°Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹ Ñ‡ÐµÑ€ÐµÐ· AI API"
          echo "ðŸš€ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ GigaChat API Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸"
          python .github/scripts/generate_content.py
          echo "=== Ð“Ð•ÐÐ•Ð ÐÐ¦Ð˜Ð¯ Ð—ÐÐ’Ð•Ð Ð¨Ð•ÐÐ ==="

      - name: Commit and push changes
        run: |
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
          
          echo "ðŸ“Š Ð¢ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð²:"
          echo "Ð¡Ñ‚Ð°Ñ‚ÑŒÐ¸:"
          find content/posts/ -name "*.md" -exec ls -la {} \; | sort -k8,8 | tail -5
          echo "Ð˜Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ:"
          find static/images/ -name "*.jpg" -exec ls -la {} \; 2>/dev/null | tail -3 || echo "ÐÐµÑ‚ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹"
          
          git add content/posts/ static/images/
          
          if git diff --staged --quiet; then
            echo "âŒ ÐÐµÑ‚ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°"
            exit 0
          fi
          
          git commit -m "ðŸ¤– Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ð°Ñ AI ÑÑ‚Ð°Ñ‚ÑŒÑ + Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ: $(date +"%d.%m.%Y")"
          git pull --rebase
          git push
          echo "âœ… Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð·Ð°Ð¿ÑƒÑˆÐµÐ½Ñ‹!"

      - name: Final report
        run: |
          echo "=== Ð¤Ð˜ÐÐÐ›Ð¬ÐÐ«Ð™ ÐžÐ¢Ð§Ð•Ð¢ ==="
          echo "ðŸ“‹ ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 3 ÑÑ‚Ð°Ñ‚ÑŒÐ¸:"
          find content/posts/ -name "*.md" -exec basename {} \; | sort -r | head -3
          echo "ðŸ–¼ï¸ ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ:"
          find static/images/ -name "*.jpg" -exec basename {} \; 2>/dev/null | sort -r | head -3 || echo "ÐÐµÑ‚ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹"
          echo "âœ… Ð’ÑÐµÐ³Ð¾ ÑÑ‚Ð°Ñ‚ÐµÐ¹: $(find content/posts/ -name "*.md" | wc -l)"
          echo "âœ… Ð’ÑÐµÐ³Ð¾ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹: $(find static/images/ -name "*.jpg" 2>/dev/null | wc -l || echo 0)"
