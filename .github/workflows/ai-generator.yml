name: AI Content Generator

on:
  schedule:
    - cron: '0 11 * * *'  # Ğ—Ğ° 1 Ñ‡Ğ°Ñ Ğ´Ğ¾ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ
  workflow_dispatch: true

permissions:
  contents: write

jobs:
  generate-content:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests

    - name: Create directory structure
      run: |
        mkdir -p content/posts
        mkdir -p assets/images/posts
        mkdir -p static/css
        mkdir -p layouts/_default
        mkdir -p layouts/partials
        echo "âœ… Directory structure created"

    - name: Check for generate script
      run: |
        echo "ğŸ” Looking for generate_content.py..."
        if [ -f ".github/scripts/generate_content.py" ]; then
            echo "âœ… Found in .github/scripts/"
        elif [ -f "generate_content.py" ]; then
            echo "âœ… Found in root"
        else
            echo "âŒ Not found, creating simple version..."
            # Create simple content generator
            cat > generate_simple.py << 'EOF'
import os
import random
from datetime import datetime

def main():
    print("ğŸ“ Generating simple content...")
    
    posts = [
        "Ğ˜ÑĞºÑƒÑÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ Ğ² 2025: Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ñ‹",
        "ĞœĞ°ÑˆĞ¸Ğ½Ğ½Ğ¾Ğµ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚Ğ¸: ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹",
        "Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ AI: Ñ‚Ğ²Ğ¾Ñ€Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸ Ğ¸Ğ½Ğ½Ğ¾Ğ²Ğ°Ñ†Ğ¸Ğ¸"
    ]
    
    os.makedirs("content/posts", exist_ok=True)
    
    for i, topic in enumerate(posts, 1):
        date = datetime.now().strftime("%Y-%m-%d")
        filename = f"content/posts/{date}-article-{i}.md"
        
        content = f"""---
title: "{topic}"
date: {date}
tags: ["AI", "Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸", "2025"]
draft: false
---

## Ğ’Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ
{topic} Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞ¾Ğ±Ğ¾Ğ¹ Ğ¾Ğ´Ğ½Ğ¾ Ğ¸Ğ· ÑĞ°Ğ¼Ñ‹Ñ… Ğ¿ĞµÑ€ÑĞ¿ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ² ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ IT-Ğ¸Ğ½Ğ´ÑƒÑÑ‚Ñ€Ğ¸Ğ¸.

## ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ
- **Ğ˜Ğ½Ğ½Ğ¾Ğ²Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸**: ĞĞ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ñ‹ Ğº Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡
- **ĞŸÑ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ**: Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ĞºĞµĞ¹ÑÑ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ² Ğ±Ğ¸Ğ·Ğ½ĞµÑĞµ Ğ¸ Ğ½Ğ°ÑƒĞºĞµ
- **Ğ‘ÑƒĞ´ÑƒÑ‰ĞµĞµ Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ğµ**: ĞŸĞµÑ€ÑĞ¿ĞµĞºÑ‚Ğ¸Ğ²Ñ‹ Ğ¸ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸

## Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ
{topic} Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµÑ‚ Ñ€Ğ°Ğ·Ğ²Ğ¸Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¼Ğ¸ Ñ‚ĞµĞ¼Ğ¿Ğ°Ğ¼Ğ¸, Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°Ñ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ² Ğ¸ Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.
"""
        
        with open(filename, 'w', encoding='utf-8') as f:
            f.write(content)
        
        print(f"âœ… Created: {filename}")

if __name__ == "__main__":
    main()
EOF
        fi

    - name: Generate content
      env:
        OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      run: |
        if [ -f ".github/scripts/generate_content.py" ]; then
            echo "ğŸš€ Running main generator..."
            cd .github/scripts/
            python generate_content.py
            cd ../../
        elif [ -f "generate_content.py" ]; then
            echo "ğŸš€ Running root generator..."
            python generate_content.py
        else
            echo "ğŸ”„ Running simple generator..."
            python generate_simple.py
        fi
        
        echo "ğŸ“Š Generated content:"
        find content/ -name "*.md" | head -5

    - name: Commit and push generated content
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "github-actions@github.com"
        
        git add content/ assets/
        
        if git diff --staged --quiet; then
          echo "â„¹ï¸ No changes to commit"
        else
          git commit -m "Auto-generated content: $(date +'%Y-%m-%d %H:%M')"
          git push origin main
          echo "âœ… Changes pushed to repository"
        fi
